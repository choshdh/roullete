
  
  
    <!DOCTYPE html>
      <html lang="ko">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>룰렛</title>
          <style>
              body {
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  height: 100vh;
                  margin: 0;
                  background-color: #f9f9f9;
                  font-family: Arial, sans-serif;
            
            /* 스크롤 완전 차단 */
            overflow: hidden;
              }
          
              .title {
                  margin-top: 35px;
                  font-size: 50px;
                  font-weight: bold;
                  text-align: center;
              }
              .main-container {
                  display: flex;
                  align-items: flex-start;
                  gap: 20px;
                  margin-top: 50px;
              }
              .wheel-container {
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  position: relative;
              }
              canvas {
                  border: 5px solid #333;
                  border-radius: 50%;
                  width: 600px;
                  height: 600px;
              }
              .pointer {
                  position: absolute;
                  top: -20px;
                  left: 50%;
                  transform: translateX(-50%);
                  width: 0;
                  height: 0;
                  border-left: 15px solid transparent;
                  border-right: 15px solid transparent;
                  border-top: 20px solid red;
                  z-index: 2;
              }
              .legends-container {
                  display: flex;
                  flex-wrap: wrap;
                  gap: 20px;
              }
              .legend {
                  display: flex;
                  flex-direction: column;
                  align-items: flex-start;
              }
              .legend-item {
                  display: flex;
                  align-items: center;
                  margin-bottom: 5px;
              }
              .color-box {
                  width: 20px;
                  height: 20px;
                  margin-right: 10px;
              }
              button {
                  margin-top: 20px;
                  padding: 10px 20px;
                  font-size: 16px;
                  cursor: pointer;
              }
          
          
          
          /* 폭죽 효과 시작 */
          .fireworks-container {
                  position: fixed;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  pointer-events: none; /* 상호작용 차단 */
                  z-index: 10;
              }

              .firework {
                  position: absolute;
                  width: 1px;
                  height: 1px;
                  background-color: #ff0;
                  border-radius: 50%;
                  animation: explode 1.5s ease-out forwards;
              }

              @keyframes explode {
                  0% {
              transform: scale(0); /* 크기가 0에서 시작 */
              opacity: 1; /* 완전히 보이는 상태 */
            }
            50% {
              transform: scale(10); /* 중간 크기로 확장 */
              opacity: 1; /* 여전히 보임 */
            }
            100% {
              transform: scale(25); /* 최종 크기로 확장 */
              opacity: 0; /* 사라짐 */
            }
              }

              #winner-message {
                  position: fixed;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  background: rgba(0, 0, 0, 0.7);
                  color: #fff;
                  padding: 20px 40px;
                  border-radius: 10px;
                  text-align: center;
                  font-size: 2em;
                  z-index: 20;
                  animation: fadeIn 0.5s ease;
              }

              .hidden {
                  display: none;
              }

              @keyframes fadeIn {
                  from {
                      opacity: 0;
                  }
                  to {
                      opacity: 1;
                  }
              }
          /* 폭죽 효과 끝 */
          
          
          /* 스포트라이트 시작 */
          .spotlight {
                  position: absolute;
                  width: 150px;
                  height: 150px;
                  border-radius: 50%;
                  background: radial-gradient(circle, rgba(255, 255, 0, 0.8) 0%, rgba(255,255,255,0) 70%);
                  pointer-events: none;
              }
          /* 스포트라이트 끝 */
          
          
          /* 추첨 사운드 시작 */
          #drumroll-sound {
            display: none;
          }
          /* 추첨 사운드 끝 */
          </style>
        <audio id="drumroll-sound" preload="auto" controls>
          <source src="https://files.catbox.moe/0e7cb7.wav">
        </audio>
      </head>
      <body>
        <div class="fireworks-container"></div>
        <div id="winner-message" class="hidden">
          <h1 id="winner-name"></h1>
        </div>
          <div class="title">
          <img src="https://i.imgur.com/SQRpzYy.png" style="height: 120px; vertical-align: middle;">
        </div>
          <div class="main-container">
              <div class="wheel-container">
                  <div class="pointer"></div>
                  <canvas id="wheel" width="600" height="600"></canvas>
                  <button onclick="spinWheel()">돌리기</button>
              </div>
              <div class="legends-container" id="legends-container"></div>
          </div>
        <!-- <div class="spotlight" id="spotlight"></div> -->

          <script>
        
          //무료 사운드 확인
          //https://pixabay.com/
        
          //무료 이미지 업로드 및 다운로드 링크 지원
          //https://imgur.com/
        
          //무료 음성 파일 올리기 및 다운로드 링크 지원
          //https://catbox.moe/
        
        
              const colors = [
                  "#CD0404", "#EE0000", "#F23B3B", "#F56666", "#F89999","#FCCCCC",
                  "#D53209", "#FF4500", "#FF6A33", "#FF8F66", "#FFB599","#FFDACC",
                  "#D36942", "#FE8052", "#FE9975", "#FEB397", "#FFCCBA","#FFE6DC",
                  "#D6AB00", "#FFD400", "#FFDD33", "#FFE566", "#FFEE99","#FFF6CC",
                  "#8EDD13", "#A1F524", "#BCF95D", "#CEFE83", "#DEFFAB","#EEFED6",
                  "#1FAD1F", "#32CD32", "#5BD75B", "#84E184", "#ADEBAD","#D6F5D6",
                  "#03C4C4", "#15DFDF", "#3BEDED", "#6DF2F2", "#9DF6F6","#CEFBFB",
                  "#163ECA", "#1C4EFC", "#4971FD", "#7795FD", "#A4B8FE","#D2DCFE",
                  "#1C2582", "#232EA3", "#4F58B5", "#7B82C8", "#A7ABDA","#D3D5ED",
                  "#471293", "#5917B8", "#7A45C6", "#9B74D4", "#BDA2E3","#DED1F1",
                  "#CC1076", "#FF1493", "#FD51AD", "#FF72BE", "#FFA1D4","#FFD0E9",
                  "#94070D", "#B90910", "#C73A40", "#D56B70", "#E39D9F","#F1CECF",
                  "#862E1D", "#A83A24", "#B96150", "#CB897C", "#DCB0A7","#EED8D3",
                  "#804106", "#A05107", "#B37439", "#C6976A", "#D9B99C","#ECDCCD",
                  "#7A7A00", "#999900", "#ADAD33", "#C2C266", "#D6D699","#EBEBCC",
                  "#006600", "#008000", "#339933", "#66B366", "#99CC99","#CCE6CC",
                  "#097C7C", "#0B9B9B", "#3CAFAF", "#6DC3C3", "#9DD7D7","#CEEBEB",
                  "#1F9AC6", "#27C1F8", "#52CDF9", "#7DDAFB", "#A9E6FC","#D4F3FE",
                  "#0056AA", "#0074E5", "#1E90FF", "#56ACFF", "#8FC8FF","#C7E3FF",
                  "#560066", "#6B0080", "#893399", "#A666B3", "#C499CC","#E1CCE6",
                  "#B214B2", "#DF19DF", "#E547E5", "#EC75EC", "#F2A3F2","#F9D1F9"
              ];

              const segments = JSON.parse('[["강희구 Honeyside of",3],["구새얀 얀진이네",4],["김성현 피부과일",1],["김영지 영디개고수",1],["남궁준 우행시",1],["박지윤 메롱시티주민",1],["박환진 경로우대",3],["서정필 팀운개박살",2],["송원영 기분좋게따스한",4],["엄준철 미드",20],["이동석 동석이긔",8],["이준석 DK Nuguri",4],["이지훈 내꿈은뽀로롱",7],["장윤호 jangbbatista",1],["정하림 보라노라파라",6],["홍석범 엉덩이빵빵빵",18],["황현진 김타쿠",3],["박진원 말차초코스무디",2],["황운석 운스",3],["황인호 이로리노",5],["박윤후 박윤후",3],["노민정 chays",3]]');

              let currentRotation = 0;
              let spinAnimationFrame = null;
          
          var fireworksInterval;

              function createWheel() {
                  const canvas = document.getElementById('wheel');
                  const ctx = canvas.getContext('2d');
                  const legendsContainer = document.getElementById('legends-container');

                  const totalWeight = segments.reduce((acc, [, weight]) => acc + weight, 0);
                  let startAngle = 0;

                  // Clear legend container
                  legendsContainer.innerHTML = '';
                  let legendGroup;

                  segments.forEach(([name, weight], index) => {
                      const segmentAngle = (weight / totalWeight) * 2 * Math.PI;
                      const color = colors[Math.floor(colors.length/segments.length)*index];

                      // Draw segment
                      ctx.beginPath();
                      ctx.moveTo(canvas.width / 2, canvas.height / 2);
                      ctx.arc(
                          canvas.width / 2,
                          canvas.height / 2,
                          canvas.width / 2,
                          startAngle,
                          startAngle + segmentAngle
                      );
                      ctx.closePath();
                      ctx.fillStyle = color;
                      ctx.fill();
                      ctx.stroke();

                      startAngle += segmentAngle;

                      // Create legend group every 20 items
                      if (index % 20 === 0) {
                          legendGroup = document.createElement('div');
                          legendGroup.className = 'legend';
                          legendsContainer.appendChild(legendGroup);
                      }

                      // Create legend item
                      const legendItem = document.createElement('div');
                      legendItem.className = 'legend-item';

                      const colorBox = document.createElement('div');
                      colorBox.className = 'color-box';
                      colorBox.style.background = color;

                      const text = document.createElement('span');
                      text.innerText = `${name} (${weight})`;

                      legendItem.appendChild(colorBox);
                      legendItem.appendChild(text);
                      legendGroup.appendChild(legendItem);
                  });
              }

              function spinWheel() {
            
            const messageContainer = document.getElementById('winner-message');
            if (!messageContainer.classList.contains('hidden')) {
              messageContainer.classList.add('hidden');
            }
            
            stopFireworksLoop();
            const fireworks = document.getElementsByClassName('firework')
            while (fireworks.length > 0) { // HTMLCollection은 실시간으로 업데이트되므로 while 루프 사용
              fireworks[0].remove(); // 첫 번째 요소를 계속 삭제
            }
              
            
            const audio = document.getElementById('drumroll-sound');
            audio.pause();
            audio.currentTime = 0;
            audio.play().catch((error) => {
              console.error('오디오 재생 중 오류 발생:', error);
            });
            
          
                  if (spinAnimationFrame) {
                      cancelAnimationFrame(spinAnimationFrame);
                  }

                  const canvas = document.getElementById('wheel');
                  const totalRotation = Math.random() * 360 + 3600;
                  const duration = 10500;
                  const startTime = performance.now();
            let isHalfSecondEventTriggered = false; // 0.5초 전 이벤트 트리거 여부

                  function animateSpin(currentTime) {
                      const elapsed = currentTime - startTime;
                      const progress = Math.min(elapsed / duration, 1);
                      const easing = 1 - Math.pow(1 - progress, 3);
                      const rotation = currentRotation + easing * totalRotation;

                      canvas.style.transform = `rotate(${rotation}deg)`;
              
              // 세로 높이 변화 계산
              const normalizedRotation = rotation % 360; // 0 ~ 360도로 정규화
              const heightFactor = Math.abs(Math.sin(normalizedRotation * (Math.PI / 180))); // 세로 높이 변화 비율 (0 ~ 1)
              
              // 흔들림 효과
              // 0.5초 전 이벤트 처리
              if (!isHalfSecondEventTriggered && elapsed >= duration - 500) {
                isHalfSecondEventTriggered = true;
                document.body.style.transition = 'transform 0.5s ease-out'; // 부드러운 이동
                document.body.style.transform = 'translateX(0)'; // 흔들림 초기화
              }else{
                const shakeIntensity = 35 * heightFactor; // 진폭 크기 조정
                document.body.style.transition = ''; // 부드러운 이동 초기화
                document.body.style.transform = `translateX(${shakeIntensity}px)`; // 흔들림 효과 적용
              }

                      if (progress < 1) {
                          spinAnimationFrame = requestAnimationFrame(animateSpin);
                
                      } else {
                          currentRotation += totalRotation % 360;
                
                          calculateResult(currentRotation);
                      }
                  }

                  spinAnimationFrame = requestAnimationFrame(animateSpin);
              }

              function calculateResult(finalRotation) {
                  const normalizedRotation = (360 - (finalRotation % 360) + 270) % 360;

                  const totalWeight = segments.reduce((acc, [, weight]) => acc + weight, 0);
                  let currentAngle = 0;

                  for (const [name, weight] of segments) {
                      const segmentAngle = (weight / totalWeight) * 360;
                      if (normalizedRotation >= currentAngle && normalizedRotation < currentAngle + segmentAngle) {
                          setTimeout(function(){
                  showWinner(name); // 당첨자 표시
                  startFireworksLoop(); // 폭죽 효과
                },50)
                          return;
                      }
                      currentAngle += segmentAngle;
                  }
              }
          
          function showWinner(name) {
            const messageContainer = document.getElementById('winner-message');
            const winnerName = document.getElementById('winner-name');
            winnerName.innerHTML = `축하합니다!<br>당첨자는 ${name}님입니다!`;
            messageContainer.classList.remove('hidden');
            
            messageContainer.onclick = function(){
              messageContainer.classList.add('hidden');
            }

          }

          function startFireworks() {
            const container = document.querySelector('.fireworks-container');

            // 폭죽 생성
            for (let i = 0; i < 250; i++) {
              const firework = document.createElement('div');
              firework.classList.add('firework');
              firework.style.left = `${Math.random() * 100}%`;
              firework.style.top = `${Math.random() * 100}%`;
              firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
              firework.style.animationDelay = `${Math.random() * 1.5}s`;
              firework.style.animationDuration = `2s`;
              container.appendChild(firework);

              // 폭죽 삭제
              setTimeout(() => {
                firework.remove();
              }, 3500);
            }
          }
          
          function startFireworksLoop() {
            startFireworks(); // 즉시 시작
            fireworksInterval = setInterval(startFireworks, 2000); // 2.5초마다 실행
          }
          
          function stopFireworksLoop() {
            if (fireworksInterval) {
              clearInterval(fireworksInterval);
              fireworksInterval = null;
            }
          }
          
          function moveSpotlight() {
                  const spotlight = document.getElementById('spotlight');
                  let x = Math.random() * window.innerWidth;
                  let y = Math.random() * window.innerHeight;

                  spotlight.style.transition = 'top 1s ease, left 1s ease';
                  spotlight.style.left = `${x}px`;
                  spotlight.style.top = `${y}px`;

                  setTimeout(moveSpotlight, 1000);
              }

              createWheel();
          //moveSpotlight();
          </script>
      </body>
      </html>

  
  
  